{% extends "ideas/base.html" %}

{% block title %}Eureka - {{idea.title}}{% endblock %}

{% block navbar-links %}

<ul class="nav navbar-nav">
  {% if user.is_authenticated %}
  <li><a href="{% url 'ideas' %}">IDEAS</a></li>
  <li><a href="{% url 'users' %}">USERS</a></li>
  {% endif %}
</ul>

{% endblock %}

{% block content %}

{% load humanize %}
{% load gravatar %}

<!-- <div class="sub-navbar">
  <div class="container">
    <img class="pull-left" src="{% gravatar_url idea.user.email 40 %}" alt="">
    <h4 class="pull-left lead">{{ idea.title }} by <a href="#">{{ idea.user.username}}</a></h4>
  </div>
</div> -->

{% if owner == "yes" %}
<script>
function confirmDel()
{
    $.post( "/eureka/ideas/{{ idea.id }}", { data: 'delete', csrfmiddlewaretoken:'{{ csrf_token }}' })
    .done(function( data ) {
        document.getElementById("delModalLabel").innerHTML = "Idea Deleted!";
        document.getElementById("delModalText").innerHTML = "Your idea has been successfully deleted!";
        $("#delModalCloseButton").hide();
        $("#delModalConfirmButton").hide();
        $("#delModalOkButton").show();
        //window.location = "/eureka/ideas/{{ idea.id }}"
    });
}

function doEdit()
{
    document.getElementById("editForm").submit();
}
</script>

<!-- Delete Idea Modal -->
<div class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 class="modal-title" id="delModalLabel">Deleting</h3>
      </div>
      <div class="modal-body">
        <div class="divDialogElements">
            <p id="delModalText">Are you sure you want to delete this idea?</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="delModalOkButton" style="display:none;" onclick="window.location = '{% url 'ideas' %}'">OK</button>
        <button type="button" class="btn btn-default" data-dismiss="modal" id="delModalCloseButton">Close</button>
        <button type="button" class="btn btn-primary" onclick="confirmDel()" id="delModalConfirmButton">Confirm</button>{% csrf_token %}
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Edit Idea Modal -->
<div class="modal fade" id="ediModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 class="modal-title" id="delModalLabel">Edit idea</h3>
      </div>
      <div class="modal-body">
        <div class="divDialogElements">
            <form id="editForm" class="form-horizontal" role="form" action="" method="POST">
                {% csrf_token %}
                <div class="form-group">
                  <label for="title">Title</label>
                  <input name="title" type="text" class="form-control" required autofocus value="{{ idea.title }}">
                </div>
                <div class="form-group">
                  <label for="text">Description</label>
                  <textarea name="text" type="text" class="form-control" required>{{ idea.text }}</textarea>
                </div>
            </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="ediModalCloseButton">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="doEdit()" id="ediModalEditButton" type="submit">Edit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endif %}

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="idea idea-details">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object" src="{% gravatar_url idea.user.email 48%}" alt="...">
                    </a>
                    {% if owner == "yes" %}
                    <div class="btn-group pull-right">
                        <button class="btn btn-default" data-toggle="modal" data-target="#ediModal">
                            <span class="glyphicon glyphicon-cog"></span>
                        </button>
                        <button class="btn btn-default" data-toggle="modal" data-target="#delModal">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </div>
                    {% endif %}
                <div class="media-body">
                    <h4 class="media-heading lead"><a href="#">{{idea.user.username}}</a></h4>
                    <h4 class="lead"><a href="{% url 'idea' idea_id=idea.id %}">{{idea.title}}</a></h4>
                    <p>{{idea.text}}</p>

                    {% if idea.interest_set.count > 0 %}
                    <div class="interested">
                      <p class="lead">Interested in this idea</p>
                      {% for interested in idea.interest_set.all|slice:":6" %}
                      <a href="#"><img src="{% gravatar_url interested.user.email 24 %}" title="{{interested.user.username}}"></a>
                      {% endfor %}
                      {% if idea.interest_set.all|length > 6 %}
                      <span>and {{ idea.interest_set.all|length|add:"-1"}} more</span>
                      {% endif %}
                  </div>
                  {% endif %}

                  <div class="idea-stats pull-right">
                      {% if idea.state == "I"%}
                      <span class="label label-warning">idle</span>
                      {% elif idea.state == "A" %}
                      <span class="label label-success">approved</span>
                      {% else %}
                      <span class="label label-danger">rejected</span>
                      {% endif %}
                      <span class="label label-default">0 likes</span>
                      <!-- <span class="label label-default">4 users interested</span> -->
                  </div>
                  <span class="pull-left">{{idea.created|naturaltime}}</span>
              </div> <!-- /mediabody -->
          </div> <!-- /media -->
      </div>


            <!-- <div class="comments">
                <h4 class="lead">0 Comments</h4>
                <hr>
            </div> -->
        </div>

        <div class="col-md-4">

        </div>
    </div>

</div><!-- /.container -->
{% endblock %}
